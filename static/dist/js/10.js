webpackJsonp([10],{"+Kwb":function(e,t){},"Odp/":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("Xxa5"),n=o.n(a),r=o("exGp"),s=o.n(r),i=o("woOf"),l=o.n(i),c={props:{runSysList:{type:Array,default:[]},userForm:{type:Object,default:{}}},data:function(){return{firstKey:0,categorieDisabled:!1,form:{bk_username:"",chname:"",email:"",phone:"",notice_methods:[],role:"",categories:[]},roleList:[{key:0,label:"超级管理员"},{key:1,label:"管理员"},{key:2,label:"操作者"},{key:3,label:"普通用户"}],methodList:[{key:0,label:"微信"},{key:1,label:"邮件"},{key:2,label:"短信"}],rules:{notice_methods:[{required:!0,message:"通知方式不能为空",trigger:"change"}],role:[{required:!0,message:"角色不能为空",trigger:"change"}]}}},created:function(){l()(this.form,this.userForm),0===this.form.role&&(this.form.categories=["all"])},methods:{handleRoleChange:function(e){0===e?(this.categorieDisabled=!0,this.form.categories=["all"]):(this.form.categories=[],this.categorieDisabled=!1)}}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"userInfo"}},[o("bk-form",{ref:"form",attrs:{"label-width":90,rules:e.rules,model:e.form}},[o("bk-form-item",{attrs:{label:"用户名:"}},[o("bk-input",{attrs:{disabled:""},model:{value:e.form.bk_username,callback:function(t){e.$set(e.form,"bk_username",t)},expression:"form.bk_username"}})],1),e._v(" "),o("bk-form-item",{attrs:{label:"中文名:"}},[o("bk-input",{attrs:{disabled:""},model:{value:e.form.chname,callback:function(t){e.$set(e.form,"chname",t)},expression:"form.chname"}})],1),e._v(" "),o("bk-form-item",{attrs:{label:"邮箱:"}},[o("bk-input",{attrs:{disabled:""},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),o("bk-form-item",{attrs:{label:"手机:"}},[o("bk-input",{attrs:{disabled:""},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),e._v(" "),o("bk-form-item",{attrs:{label:"通知方式:","error-display-type":"normal",required:!0,property:"notice_methods"}},[o("bk-select",{attrs:{multiple:"","display-tag":""},model:{value:e.form.notice_methods,callback:function(t){e.$set(e.form,"notice_methods",t)},expression:"form.notice_methods"}},e._l(e.methodList,function(e){return o("bk-option",{key:e.key,attrs:{id:e.key,name:e.label}})}),1)],1),e._v(" "),o("bk-form-item",{attrs:{label:"角色:","error-display-type":"normal",required:!0,property:"role"}},[o("bk-select",{on:{change:e.handleRoleChange},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}},e._l(e.roleList,function(e){return o("bk-option",{key:e.key,attrs:{id:e.key,name:e.label}})}),1)],1),e._v(" "),o("bk-form-item",{attrs:{label:"系统类别:"}},[o("bk-select",{attrs:{disabled:e.categorieDisabled,multiple:"","display-tag":""},model:{value:e.form.categories,callback:function(t){e.$set(e.form,"categories",t)},expression:"form.categories"}},[0===e.form.role?o("bk-option",{attrs:{id:"all",name:"全部"}}):e._l(e.runSysList,function(e){return o("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})],2)],1)],1)],1)},staticRenderFns:[]};var u=o("VU/8")(c,d,!1,function(e){o("+Kwb")},"data-v-a67319c0",null).exports,f=o("s0MJ"),h={components:{userInfo:u},props:{runSysList:{type:Array,default:[]}},data:function(){return{dialogLoading:!1,closeIconShow:!0,name:"",tableList:[],tableLoading:!1,addUserDialogShow:!1,userForm:{},userInfoKey:0,midTableList:[]}},created:function(){this.handleLoad()},methods:{handleAdduser:function(e){this.userForm={bk_username:e.username,chname:e.display_name,email:e.email,phone:e.telephone},this.userInfoKey+=1,this.addUserDialogShow=!0},handleConfim:function(){var e=this;this.dialogLoading=!0,this.$refs.userInfo.$refs.form.validate().then(function(t){e.closeIconShow=!1;var o={bk_username:e.$refs.userInfo.form.bk_username,role:e.$refs.userInfo.form.role,chname:e.$refs.userInfo.form.chname,email:e.$refs.userInfo.form.email,phone:e.$refs.userInfo.form.phone,notice_methods:e.$refs.userInfo.form.notice_methods,categories:0===e.$refs.userInfo.form.role?"all":e.$refs.userInfo.form.categories};e.$api.user.create(o).then(function(t){t.result?(e.addUserDialogShow=!1,e.handleLoad(),e.$emit("after-add-user"),e.$cwMessage("新增成功!","success")):e.$cwMessage(t.message,"error"),e.closeIconShow=!0,e.dialogLoading=!1})}).catch(function(t){e.$cwMessage("您的输入有误，请检查输入！","warning"),e.dialogLoading=!1})},handleSearch:function(){var e=this,t=this.midTableList.filter(function(t){return!e.name||t.display_name.toLowerCase().includes(e.name.toLowerCase())||t.username.toLowerCase().includes(e.name.toLowerCase())});this.tableList=Object(f.a)(t)},handleLoad:function(){var e=this;this.tableLoading=!0,this.$api.user.get_uncreated_users().then(function(t){t.result?(e.tableList=t.data,e.midTableList=t.data):e.$cwMessage(t.message,"error"),e.tableLoading=!1})}}},m={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"addUser"}},[o("div",{staticClass:"header-search"},[o("bk-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入用户名或中文名","right-icon":"bk-icon icon-search",clearable:!0},on:{enter:e.handleSearch,"right-icon-click":e.handleSearch},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),o("div",{staticClass:"content"},[o("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:e.tableList,"ext-cls":"customTable"}},[o("bk-table-column",{attrs:{label:"用户名",prop:"username","show-overflow-tooltip":!0}}),e._v(" "),o("bk-table-column",{attrs:{label:"中文名",prop:"display_name","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(""===t.row.display_name?"- -":t.row.display_name))])]}}])}),e._v(" "),o("bk-table-column",{attrs:{label:"邮箱",prop:"email","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(""===t.row.email?"- -":t.row.email))])]}}])}),e._v(" "),o("bk-table-column",{attrs:{label:"手机",prop:"telephone","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(""===t.row.telephone?"- -":t.row.telephone))])]}}])}),e._v(" "),o("bk-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("bk-button",{staticClass:"mr10",attrs:{theme:"success",text:""},on:{click:function(o){return e.handleAdduser(t.row)}}},[e._v("添加")])]}}])})],1)],1),e._v(" "),o("bk-dialog",{attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:"新增用户","show-footer":!0,position:{top:50},draggable:!1,width:"600",loading:e.dialogLoading,"close-icon":e.closeIconShow},on:{confirm:e.handleConfim},model:{value:e.addUserDialogShow,callback:function(t){e.addUserDialogShow=t},expression:"addUserDialogShow"}},[o("user-info",{key:e.userInfoKey,ref:"userInfo",attrs:{"run-sys-list":e.runSysList,"user-form":e.userForm}})],1)],1)},staticRenderFns:[]};var b={components:{addUserDialog:o("VU/8")(h,m,!1,function(e){o("Y6j1")},"data-v-0f44bba6",null).exports,userInfo:u},data:function(){return{maxTableHeight:"",auth:{},method_list:[{key:0,label:"微信"},{key:1,label:"邮件"},{key:2,label:"短信"}],userInfoKey:0,infodialogLoading:!1,infocloseIconShow:!0,infoDialogShow:!1,addUserDialogShow:!1,addUserDialogKey:0,userForm:{},dialogKey:0,tableList:[],runSysList:[],tableLoading:!1,searchFrom:{name:""},pagination:{current:1,count:1,limit:10}}},computed:{},created:function(){this.handleLoad(),this.getRunSysList(),this.auth=this.hasPerm(this.$route.path),this.maxTableHeight=this.$store.state.common.defaultTableHeight-52},methods:{notice:function(e){var t=this,o=[];return e.notice_methods.forEach(function(e){t.method_list.forEach(function(t){t.key===e&&o.push(t.label)})}),o.join(",")},categorie:function(e){var t=this,o=[];return e.categories.forEach(function(e){t.runSysList.forEach(function(t){t.id===e&&o.push(t.name)})}),o.join(",")},handleOpenAddDialog:function(){this.addUserDialogKey+=1,this.addUserDialogShow=!0},handleOpenUserDialog:function(e){this.userForm={bk_username:e.bk_username,chname:e.chname,email:e.email,phone:e.phone,notice_methods:e.notice_methods,role:e.role,categories:e.categories,id:e.id},this.userInfoKey+=1,this.infoDialogShow=!0},handleDelete:function(e){var t,o=this;this.$bkInfo({type:"primary",title:"确认要删除吗？",confirmLoading:!1,confirmFn:(t=s()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o.$api.user.delete(e.id).then(function(e){e.result?(o.$cwMessage("删除成功！","success"),1===o.tableList.length&&1!==o.pagination.current&&(o.pagination.current-=1),o.handleLoad()):o.$cwMessage(e.message,"error")});case 1:case"end":return t.stop()}},t,o)})),function(){return t.apply(this,arguments)})})},handleConfim:function(){var e=this;this.infodialogLoading=!0,this.$refs.userInfo.$refs.form.validate().then(function(t){e.infocloseIconShow=!1,e.tableLoading=!0;var o={bk_username:e.$refs.userInfo.form.bk_username,role:e.$refs.userInfo.form.role,chname:e.$refs.userInfo.form.chname,email:e.$refs.userInfo.form.email,phone:e.$refs.userInfo.form.phone,notice_methods:e.$refs.userInfo.form.notice_methods,categories:0===e.$refs.userInfo.form.role?"all":e.$refs.userInfo.form.categories};e.$api.user.update(e.$refs.userInfo.form.id,o).then(function(t){t.result?(e.$cwMessage("修改成功!","success"),e.infoDialogShow=!1,e.handleLoad()):e.$cwMessage(t.message,"error"),e.infocloseIconShow=!0,e.infodialogLoading=!1,e.tableLoading=!1})}).catch(function(t){e.$cwMessage("您的输入有误，请检查输入！","warning"),e.infodialogLoading=!1})},handleSearch:function(){this.pagination.current=1,this.handleLoad()},handlePageLimitChange:function(e){this.pagination.current=1,this.pagination.limit=e,this.handleLoad()},handlePageChange:function(e){this.pagination.current=e,this.handleLoad()},handleLoad:function(){var e=this;this.tableLoading=!0,this.$api.user.list({search:this.searchFrom.name,page:this.pagination.current,page_size:this.pagination.limit}).then(function(t){t.result?(e.pagination.count=t.data.count,e.tableList=t.data.items):e.$cwMessage(t.message,"error"),e.tableLoading=!1})},getRunSysList:function(){var e=this;this.tableLoading=!0,this.$api.category.list().then(function(t){t.result?e.runSysList=t.data.items:e.$cwMessage(t.message,"error"),e.tableLoading=!1})}}},p={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"userPermission"}},[e.auth.create||e.auth.search?o("div",{staticClass:"header"},[e.auth.create?o("div",{staticStyle:{float:"left"}},[o("bk-button",{attrs:{theme:"primary"},on:{click:e.handleOpenAddDialog}},[e._v("新增用户")])],1):e._e(),e._v(" "),e.auth.search?o("div",{staticStyle:{float:"right"}},[o("bk-input",{staticStyle:{width:"240px"},attrs:{clearable:"",width:"240px",placeholder:"请输入用户名或中文名","right-icon":"bk-icon icon-search"},on:{"right-icon-click":e.handleSearch,enter:e.handleSearch},model:{value:e.searchFrom.name,callback:function(t){e.$set(e.searchFrom,"name",t)},expression:"searchFrom.name"}})],1):e._e()]):e._e(),e._v(" "),o("div",{staticStyle:{clear:"both"}}),e._v(" "),o("div",{staticClass:"content"},[o("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:e.tableList,pagination:e.pagination,"ext-cls":"customTable","max-height":e.maxTableHeight},on:{"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange}},[o("bk-table-column",{attrs:{label:"用户名",prop:"bk_username","show-overflow-tooltip":!0}}),e._v(" "),o("bk-table-column",{attrs:{label:"中文名",prop:"chname","show-overflow-tooltip":!0}}),e._v(" "),o("bk-table-column",{attrs:{label:"邮箱",prop:"email","show-overflow-tooltip":!0}}),e._v(" "),o("bk-table-column",{attrs:{label:"手机",prop:"phone","show-overflow-tooltip":!0}}),e._v(" "),o("bk-table-column",{attrs:{label:"通知方式",prop:"notice_methods","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e.notice(t.row)))])]}}])}),e._v(" "),o("bk-table-column",{attrs:{label:"角色",prop:"role","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.role?o("span",[e._v("超级管理员")]):1===t.row.role?o("span",[e._v("管理员")]):2===t.row.role?o("span",[e._v("操作者")]):3===t.row.role?o("span",[e._v("普通用户")]):e._e()]}}])}),e._v(" "),o("bk-table-column",{attrs:{label:"系统类别",prop:"categories","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e.categorie(t.row)))])]}}])}),e._v(" "),o("bk-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(o){return e.handleOpenUserDialog(t.row)}}},[e._v("修改")]),e._v(" "),o("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(o){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),o("bk-dialog",{attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:"修改","show-footer":!0,position:{top:50},draggable:!1,width:"600",loading:e.infodialogLoading,"close-icon":e.infocloseIconShow},on:{confirm:e.handleConfim},model:{value:e.infoDialogShow,callback:function(t){e.infoDialogShow=t},expression:"infoDialogShow"}},[o("user-info",{key:e.userInfoKey,ref:"userInfo",attrs:{"run-sys-list":e.runSysList,"user-form":e.userForm}})],1),e._v(" "),o("bk-dialog",{attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:"选择新增用户","show-footer":!0,position:{top:50},draggable:!1,width:"800","ext-cls":"custom-dialog"},model:{value:e.addUserDialogShow,callback:function(t){e.addUserDialogShow=t},expression:"addUserDialogShow"}},[o("add-user-dialog",{key:e.addUserDialogKey,attrs:{"run-sys-list":e.runSysList},on:{"after-add-user":e.handleLoad}}),e._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("bk-button",{on:{click:function(t){e.addUserDialogShow=!1}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var g=o("VU/8")(b,p,!1,function(e){o("xNo7")},"data-v-49c70eba",null);t.default=g.exports},Y6j1:function(e,t){},xNo7:function(e,t){}});