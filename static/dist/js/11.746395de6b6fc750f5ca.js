webpackJsonp([11],{C8xT:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Dd8w"),n=i.n(a),o=i("woOf"),s=i.n(o),l=i("Xxa5"),r=i.n(l),c=i("exGp"),d=i.n(c),u={components:{FormRender:i("Kp5p").a},props:{nodeData:{type:Object,default:{}},isShowBtn:{type:Boolean,default:!0}},data:function(){return{disabled:!1,isChecking:!1,inputsData:{},rules:{node_name:[{required:!0,message:"必填项",trigger:"change"}],fail_retry_count:[{required:!0,message:"必填项",trigger:"change"}]},controlType:"",tableList:[],reviewList:[{label:"正常运行",value:1},{label:"禁止运行",value:0}],timeTypeList:[{value:"hours",label:"时"},{value:"minutes",label:"分"},{value:"seconds",label:"秒"}],requestTypeList:[{value:"get",label:"GET"},{value:"post",label:"POST"},{value:"put",label:"PUT"},{value:"head",label:"HEAD"},{value:"delete",label:"DELETE"}],checkPointTypeList:[{value:"status_code",label:"默认响应码"},{value:"code",label:"自定义响应码"},{value:"content",label:"返回内容"}],checkPointConditionList:[{value:"equal",label:"等于"},{value:"not_equal",label:"不等于"},{value:"contain",label:"包含"},{value:"not_contain",label:"不包含"}],form:{inputs:{url:"",method:"",header:[{key:"",value:""}],body:"",timeout:"",check_point:{key:"",condition:"",values:""}},outputs:[],node_name:"",run_mark:1,description:"",fail_retry_count:0,fail_offset:"",fail_offset_unit:"seconds",is_skip_fail:!1,is_timeout_alarm:!1}}},created:function(){this.form=this.nodeData.data,"[object Object]"!==Object.prototype.toString.call(this.form.inputs)&&(this.form.inputs=JSON.parse(this.form.inputs)),"[object Array]"!==Object.prototype.toString.call(this.form.inputs_component)&&(this.form.inputs_component=JSON.parse(this.form.inputs_component)),"[object Array]"!==Object.prototype.toString.call(this.form.outputs)?this.tableList=JSON.parse(this.form.outputs):this.tableList=this.form.outputs,"detail"===this.$route.query.type&&(this.disabled=!0)},methods:{handleEtaChange:function(e){this.form.eta=e},handleTimePointChange:function(e){},handleConfim:function(){var e=this;this.isChecking=!0,this.$refs.form.validate().then(function(t){e.isChecking=!1,e.form.outputs=e.tableList,e.$emit("update-node-data",e.form,e.nodeData.id),e.$cwMessage("保存成功！","success"),e.$emit("node-drawer-close",!0)},function(t){e.isChecking=!1})},handleCancel:function(){var e=this;this.isChecking=!0,this.$refs.form.validate().then(function(t){e.isChecking=!1,e.$emit("update-node-data",e.form,e.nodeData.id),e.form.name=e.form.node_name,e.form.component_code="http_request",e.$api.content.create(e.form).then(function(t){t.result?e.$cwMessage("保存成功！","success"):e.$cwMessage(t.message,"error")}),e.$emit("node-drawer-close",!0)},function(t){e.isChecking=!1})},handleDeleteCommand:function(e){this.form.inputs.header.splice(e,1)},handleAddCommand:function(){this.form.inputs.header.push({key:"",value:""})}}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"nodeInfo"}},[i("div",{staticClass:"content"},[i("div",{staticClass:"box"},[i("p",{staticClass:"title"},[e._v("节点设置")]),e._v(" "),i("div",{staticClass:"info"},[i("bk-form",{ref:"form",attrs:{"label-width":144,rules:e.rules,model:e.form}},[i("bk-form-item",{attrs:{label:"节点名称:",required:!0,"error-display-type":"normal",property:"node_name"}},[i("bk-input",{staticStyle:{width:"350px","margin-right":"9px"},attrs:{type:"text",disabled:e.disabled},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"运行标志:",required:!0,"error-display-type":"normal",property:"run_mark"}},[i("bk-radio-group",{model:{value:e.form.run_mark,callback:function(t){e.$set(e.form,"run_mark",t)},expression:"form.run_mark"}},e._l(e.reviewList,function(t,a){return i("bk-radio",{key:a,staticStyle:{"margin-right":"24px"},attrs:{value:t.value,disabled:e.disabled}},[e._v("\n                                "+e._s(t.label)+"\n                            ")])}),1)],1),e._v(" "),i("bk-form-item",{attrs:{label:"描述:"}},[i("bk-input",{staticStyle:{width:"350px","margin-right":"9px"},attrs:{type:"textarea",disabled:e.disabled,min:0},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"失败重试次数:",required:!0,"error-display-type":"normal",property:"fail_retry_count"}},[i("bk-input",{staticStyle:{width:"350px","margin-right":"9px"},attrs:{type:"number",disabled:e.disabled,min:0},model:{value:e.form.fail_retry_count,callback:function(t){e.$set(e.form,"fail_retry_count",t)},expression:"form.fail_retry_count"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"失败重试间隔:"}},[i("bk-compose-form-item",[i("bk-input",{staticStyle:{width:"139px","margin-right":"9px"},attrs:{type:"number",disabled:e.disabled,min:0},model:{value:e.form.fail_offset,callback:function(t){e.$set(e.form,"fail_offset",t)},expression:"form.fail_offset"}}),e._v(" "),i("bk-select",{staticStyle:{"background-color":"#fff",width:"138px","margin-right":"14px"},attrs:{clearable:!0,placeholder:"请选择",disabled:e.disabled},model:{value:e.form.fail_offset_unit,callback:function(t){e.$set(e.form,"fail_offset_unit",t)},expression:"form.fail_offset_unit"}},e._l(e.timeTypeList,function(e,t){return i("bk-option",{key:t,attrs:{id:e.value,name:e.label}})}),1),e._v(" "),i("span",[e._v("产生重试")])],1)],1),e._v(" "),i("bk-form-item",{attrs:{label:"忽略失败:"}},[i("bk-switcher",{attrs:{disabled:e.disabled},model:{value:e.form.is_skip_fail,callback:function(t){e.$set(e.form,"is_skip_fail",t)},expression:"form.is_skip_fail"}})],1),e._v(" "),i("bk-form-item",{attrs:{label:"超时告警:"}},[i("bk-switcher",{attrs:{disabled:e.disabled},model:{value:e.form.is_timeout_alarm,callback:function(t){e.$set(e.form,"is_timeout_alarm",t)},expression:"form.is_timeout_alarm"}})],1),e._v(" "),i("bk-divider",{staticStyle:{width:"540px",position:"relative",right:"20px","border-color":"#dcdee5"}}),e._v(" "),i("p",{staticClass:"title"},[e._v("输入参数")]),e._v(" "),i("form-render",{ref:"form_render",attrs:{forms:e.form.inputs_component,mode:e.disabled?"DESIGN":"PC"},model:{value:e.form.inputs,callback:function(t){e.$set(e.form,"inputs",t)},expression:"form.inputs"}}),e._v(" "),i("bk-divider",{staticStyle:{width:"540px",position:"relative",right:"20px","border-color":"#dcdee5"}})],1)],1)]),e._v(" "),i("div",{staticClass:"box"},[i("p",{staticClass:"title"},[e._v("输出参数")]),e._v(" "),i("bk-form",[i("bk-table",{attrs:{data:e.tableList}},[i("bk-table-column",{attrs:{label:"名称",prop:"name","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[i("bk-input",{model:{value:t.row.name,callback:function(i){e.$set(t.row,"name",i)},expression:"props.row.name"}})]}}])}),e._v(" "),i("bk-table-column",{attrs:{label:"KEY",prop:"key","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[i("bk-input",{model:{value:t.row.key,callback:function(i){e.$set(t.row,"key",i)},expression:"props.row.key"}})]}}])}),e._v(" "),i("bk-table-column",{attrs:{label:"引用",prop:"reference"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("bk-checkbox",{attrs:{disabled:e.disabled,"true-value":1,"false-value":0},model:{value:t.row.reference,callback:function(i){e.$set(t.row,"reference",i)},expression:"props.row.reference"}})]}}])})],1)],1)],1)]),e._v(" "),e.disabled?e._e():i("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowBtn,expression:"isShowBtn"}],staticClass:"footer"},[i("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"primary",loading:e.isChecking},on:{click:e.handleConfim}},[e._v("确定\n        ")]),e._v(" "),i("bk-button",{on:{click:e.handleCancel}},[e._v("保存为模板")])],1)])},staticRenderFns:[]};var p=i("VU/8")(u,h,!1,function(e){i("jIhf")},"data-v-3d39bc4b",null).exports,f=i("M4fF"),m=i.n(f),b={components:{jobDialog:p},data:function(){var e=[{id:"name",label:"作业名",overflowTooltip:!0,sortable:!1},{id:"template_type",label:"模板类型",overflowTooltip:!0,sortable:!1},{id:"description",label:"作业描述",overflowTooltip:!0,sortable:!1}];return{searchData:[{name:"作业名称",id:"name",multiable:!1,children:[]},{name:"模版类型",id:"template_type",multiable:!0,children:[{id:"0",name:"标准节点",value:"0"},{id:"1",name:"自定义节点",value:"1"},{id:"2",name:"节点模版",value:"2"}]},{name:"作业描述",id:"description",multiable:!1,children:[]},{name:"创建人",id:"creator",multiable:!1,children:[]}],demo1:{value:[]},maxTableHeight:"",auth:{},dialogKey:0,jobFrom:{},setting:{size:"small",fields:e,selectedFields:e.slice(0,8)},tableLoading:!1,tableList:[],runSysList:[{id:"0",name:"标准节点"},{id:"1",name:"自定义节点"},{id:"2",name:"节点模版"}],isDropdownShow:!1,searchFrom:{name:"",template_type:"",description:"",creator:""},pagination:{current:1,count:1,limit:10},selectionList:[],dialogShow:!1,searchVal:""}},created:function(){this.handleLoad(),this.auth=this.hasPerm(this.$route.path),this.maxTableHeight=this.$store.state.common.defaultTableHeight-52},methods:{handCreate:function(){this.$router.push({path:"/singlejob",query:{type:"add"}})},handleJumpHistory:function(e){this.$store.commit("changeTabActive","jobviewhistory"),this.$router.push({path:"/jobviewhistory",query:{job_id:e.id}})},handleClone:function(e){this.$router.push({path:"/singlejob",query:{type:"clone",job_id:e.id}})},handleSettingChange:function(e){var t=e.fields,i=e.size;this.setting.size=i,this.setting.selectedFields=t},handleOpenDetail:function(e){this.dialogKey+=1,this.jobFrom=e,this.dialogShow=!0},handleSelectAll:function(e){var t=this;e.length>0?this.selectionList=this.selectionList.concat(e):this.tableList.forEach(function(e){t.selectionList=t.selectionList.filter(function(t){return t.id!==e.id})})},handleSelect:function(e,t){var i=this.selectionList.find(function(e){return e.id===t.id});i?this.selectionList=this.selectionList.filter(function(e){return e.id!==i.id}):this.selectionList.push(t)},handleExportFiles:function(){if(0===this.selectionList.length)return this.$cwMessage("至少选择一条数据！","warning");var e=[];this.selectionList.forEach(function(t){e.indexOf(t.id)<0&&e.push(t.id)}),window.open(window.siteUrl+"/export/content/?id="+e.join(","))},handleOpenUpdate:function(e){this.$router.push({path:"/singlejob",query:{type:"update",job_id:e.id}})},handleDelete:function(e){var t,i=this;this.$bkInfo({type:"primary",title:"确认要删除吗？",confirmLoading:!1,confirmFn:(t=d()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i.tableLoading=!0,i.$api.content.delete(e.id).then(function(e){e.result?(i.$cwMessage("删除成功！","success"),1===i.tableList.length&&1!==i.pagination.current&&(i.pagination.current-=1),i.handleLoad()):i.$cwMessage(e.message,"error"),i.tableLoading=!1});case 2:case"end":return t.stop()}},t,i)})),function(){return t.apply(this,arguments)})})},getRunSysList:function(){var e=this;this.$api.category.list().then(function(t){t.result?e.runSysList=t.data.items:e.$cwMessage(t.message,"error")})},getSearchVal:function(e){var t=m.a.cloneDeep(e);this.searchVal=t.map(function(e){return e.multiable?e:s()(e,{values:e.values&&e.values.length?[e.values[e.values.length-1]]:[]})})},handleReset:function(){this.searchFrom={name:"",station_name:"",category:"",ip:"",process_name:"",creator:""},this.handleLoad()},handleOpenSeniorSearch:function(){this.isDropdownShow=!this.isDropdownShow},handlePageLimitChange:function(e){this.pagination.current=1,this.pagination.limit=e,this.handleLoad()},handleSearch:function(e){var t={};for(var i in e.forEach(function(e){t[e.id]?t[e.id]=t[e.id].concat(e.values.map(function(e){return e.value||e.id})):t[e.id]=e.values.map(function(e){return e.value||e.id})}),t)t[i]=t[i].join(",");this.pagination.current=1,this.searchFrom=t,this.handleLoad()},handlePageChange:function(e){this.pagination.current=e,this.handleLoad()},defaultCheck:function(){var e=this;this.$nextTick(function(){e.selectionList.forEach(function(t){e.tableList.forEach(function(i){t.id===i.id&&e.$refs.table.toggleRowSelection(i,!0)})})})},handleLoad:function(){var e=this;this.tableLoading=!0,this.$api.content.list(n()({},this.searchFrom,{page:this.pagination.current,page_size:this.pagination.limit})).then(function(t){t.result?(e.pagination.count=t.data.count,e.tableList=t.data.items,e.selectionList.length>0&&e.defaultCheck()):e.$cwMessage(t.message,"error"),e.tableLoading=!1})}}},v={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"jobList"}},[i("div",{staticClass:"header"},[i("div",{staticClass:"search-box"},[i("div",{staticClass:"add-in"},[i("button",{staticClass:"button",attrs:{theme:"primary"},on:{click:e.handCreate}},[e._v("新建")])]),e._v(" "),e.auth.search?i("div",{staticClass:"search-in"},[i("bk-search-select",{attrs:{"show-popover-tag-change":!0,data:e.searchData,"show-condition":!1,placeholder:"请输入过滤条件"},on:{change:e.handleSearch},model:{value:e.demo1.value,callback:function(t){e.$set(e.demo1,"value",t)},expression:"demo1.value"}})],1):e._e()])]),e._v(" "),i("div",{staticClass:"content"},[i("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:e.tableList,pagination:e.pagination,"ext-cls":"customTable",size:e.setting.size,"max-height":e.maxTableHeight},on:{"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange,"select-all":e.handleSelectAll,select:e.handleSelect}},[e._l(e.setting.selectedFields,function(t,a){return i("bk-table-column",{key:a,attrs:{label:t.label,prop:t.id,"show-overflow-tooltip":t.overflowTooltip,sortable:t.sortable},scopedSlots:e._u([{key:"default",fn:function(a){return["name"===t.id?i("span",{staticStyle:{color:"#052150",cursor:"pointer","font-weight":"400","text-decoration":"underline"},on:{click:function(t){return e.handleOpenDetail(a.row)}}},[e._v(e._s(a.row[t.id]))]):"template_type"===t.id?i("span",["0"===a.row.template_type?i("span",[i("bk-tag",{attrs:{radius:"5px"}},[e._v("标准节点")])],1):"2"===a.row.template_type?i("span",[i("bk-tag",{staticStyle:{color:"#153c6b"},attrs:{radius:"5px"}},[e._v("节点模版")])],1):"1"===a.row.template_type?i("span",[i("bk-tag",{staticStyle:{color:"#07254f"},attrs:{radius:"5px"}},[e._v("自定义节点")])],1):e._e()]):i("span",[e._v(e._s(""===a.row[t.id]||null===a.row[t.id]?"- -":a.row[t.id]))])]}}],null,!0)})}),e._v(" "),i("bk-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticStyle:{display:"flex","align-items":"center"}},[e.auth.modify?i("bk-button",{staticClass:"mr10 btn-color",attrs:{theme:"primary",text:""},on:{click:function(i){return e.handleOpenUpdate(t.row)}}},[e._v("修改\n                        ")]):e._e(),e._v(" "),e.auth.modify?i("bk-button",{staticClass:"mr10 btn-color",attrs:{theme:"primary",text:""},on:{click:function(i){return e.handleClone(t.row)}}},[e._v("克隆\n                        ")]):e._e(),e._v(" "),"0"!==t.row.template_type?i("bk-button",{staticClass:"mr10 btn-color",attrs:{theme:"primary",text:""},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("删除\n                        ")]):e._e()],1)]}}])}),e._v(" "),i("bk-table-column",{attrs:{type:"setting"}},[i("bk-table-setting-content",{attrs:{fields:e.setting.fields,selected:e.setting.selectedFields,size:e.setting.size},on:{"setting-change":e.handleSettingChange}})],1)],2)],1),e._v(" "),i("div",[i("bk-sideslider",{attrs:{"is-show":e.dialogShow,"quick-close":!0,title:"作业详情",width:600,"ext-cls":"custom-sidelider"},on:{"update:isShow":function(t){e.dialogShow=t},"update:is-show":function(t){e.dialogShow=t}}},[i("div",{staticStyle:{height:"100%"},attrs:{slot:"content"},slot:"content"},[i("job-dialog",{attrs:{slot:"content","node-data":{data:e.jobFrom},"is-show-btn":!1},slot:"content"})],1)])],1)])},staticRenderFns:[]};var g=i("VU/8")(b,v,!1,function(e){i("J7uL"),i("pkHM")},"data-v-1fb1b1b9",null);t.default=g.exports},J7uL:function(e,t){},jIhf:function(e,t){},pkHM:function(e,t){}});