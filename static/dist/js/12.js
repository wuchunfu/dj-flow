webpackJsonp([12],{"1KmI":function(e,t){},kb14:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("Dd8w"),n=a.n(o),i=a("Xxa5"),r=a.n(i),s=a("exGp"),l=a.n(s),c=a("s0MJ"),h={props:{operationFlag:{type:String,default:""},agentFrom:{type:Object,default:{}}},data:function(){return{hostShow:!1,form:{name:"",biz_id:"",ip:"",category:"",max_concurrency:10},formLoading:!1,bizList:[],runSysList:[],hostList:[],rules:{name:[{required:!0,message:"Agent不能为空",trigger:"blur"}],biz_id:[{required:!0,message:"业务不能为空",trigger:"change"}],ip:[{required:!0,message:"ip不能为空",trigger:"change"}],category:[{required:!0,message:"跑批系统不能为空",trigger:"change"}],max_concurrency:[{required:!0,message:"作业开发限制不能为空",trigger:"blur"}]}}},created:function(){"修改Agent"===this.operationFlag&&this.initHostList(),this.initBizList(),this.initRunSysList()},methods:{handleHostChange:function(e){var t=this;this.hostList.forEach(function(a){a.bk_host_innerip===e&&""===a.bk_cloud_id&&(t.form.ip="",t.$cwMessage("该主机下没有云区域ID，请换台主机！","warning"))})},handleAddAgent:function(e){var t=this;this.formLoading=!0,this.$parent.$parent.closeIconShow=!1;var a=n()({},this.form,{biz_name:e.bk_biz_name,os:e.bk_os_name,cloud:e.bk_cloud_id,data:e});this.$api.station.create(a).then(function(e){e.result?(t.$cwMessage("添加成功！","success"),t.$emit("close-dialog",!0)):t.$cwMessage(e.message,"error"),t.$parent.$parent.closeIconShow=!0,t.$parent.$parent.dialogLoading=!1,t.formLoading=!1})},handleUpdateAgent:function(e){var t=this;this.formLoading=!0,this.$parent.$parent.closeIconShow=!1;var a={name:this.form.name,biz_id:this.form.biz_id,ip:this.form.ip,category:this.form.category,max_concurrency:this.form.max_concurrency,biz_name:e.bk_biz_name,os:e.bk_os_name,cloud:e.bk_cloud_id,data:e};this.$api.station.update(this.form.id,a).then(function(e){e.result?(t.$cwMessage("修改成功！","success"),t.$emit("close-dialog",!0)):t.$cwMessage(e.message,"error"),t.$parent.$parent.closeIconShow=!0,t.$parent.$parent.dialogLoading=!1,t.formLoading=!1})},handleBizChange:function(e){var t=this;this.hostShow=!1,this.form.ip="",this.$api.station.search_host({biz_id:e}).then(function(e){e.result?t.hostList=e.data:t.$cwMessage(e.message,"error"),t.hostShow=!0})},initBizList:function(){var e=this;this.formLoading=!0,this.$api.station.get_biz().then(function(t){t.result?e.bizList=t.data.info:e.$cwMessage(t.message,"error"),e.formLoading=!1})},initRunSysList:function(){this.runSysList=[]},initHostList:function(){var e=this;this.form=Object(c.a)(this.agentFrom),this.formLoading=!0,this.hostShow=!1,this.$api.station.search_host({biz_id:this.form.biz_id}).then(function(t){t.result?e.hostList=t.data:e.$cwMessage(t.message,"error"),e.formLoading=!1,e.hostShow=!0})}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.formLoading,zIndex:10},expression:"{ isLoading: formLoading, zIndex: 10 }"}],attrs:{id:"agentDialog"}},[a("bk-form",{ref:"form",attrs:{"label-width":120,rules:e.rules,model:e.form}},[a("bk-form-item",{attrs:{label:"Agent","error-display-type":"normal",required:!0,property:"name"}},[a("bk-input",{attrs:{placeholder:"Agent"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"业务","error-display-type":"normal",required:!0,property:"biz_id"}},[a("bk-select",{staticClass:"header-select",staticStyle:{"background-color":"#fff"},attrs:{clearable:!1,placeholder:"请选择"},on:{change:e.handleBizChange},model:{value:e.form.biz_id,callback:function(t){e.$set(e.form,"biz_id",t)},expression:"form.biz_id"}},e._l(e.bizList,function(e,t){return a("bk-option",{key:t,attrs:{id:e.bk_biz_id,name:e.bk_biz_name}})}),1)],1),e._v(" "),a("bk-form-item",{attrs:{label:"IP","error-display-type":"normal",required:!0,property:"ip"}},[a("bk-select",{staticClass:"header-select",staticStyle:{"background-color":"#fff"},attrs:{clearable:!1,placeholder:"请选择"},on:{change:e.handleHostChange},model:{value:e.form.ip,callback:function(t){e.$set(e.form,"ip",t)},expression:"form.ip"}},e._l(e.hostList,function(t,o){return e.hostShow?a("bk-option",{key:o,attrs:{id:t.bk_host_innerip,name:t.bk_host_innerip}}):e._e()}),1)],1),e._v(" "),a("bk-form-item",{attrs:{label:"跑批系统","error-display-type":"normal",required:!0,property:"category"}},[a("bk-select",{staticClass:"header-select",staticStyle:{"background-color":"#fff"},attrs:{clearable:!1,placeholder:"请选择"},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},e._l(e.runSysList,function(e,t){return a("bk-option",{key:t,attrs:{id:e.id,name:e.name}})}),1)],1),e._v(" "),a("bk-form-item",{attrs:{label:"作业并发限制","error-display-type":"normal",required:!0,property:"max_concurrency"}},[a("bk-input",{attrs:{placeholder:"作业并发限制",type:"number",min:0},model:{value:e.form.max_concurrency,callback:function(t){e.$set(e.form,"max_concurrency",t)},expression:"form.max_concurrency"}})],1)],1)],1)},staticRenderFns:[]};var g={components:{agentDialog:a("VU/8")(h,d,!1,function(e){a("1KmI")},"data-v-562c8b0b",null).exports},data:function(){return{maxTableHeight:"",auth:{},agentFrom:{},operationFlag:"",dialogKey:0,dialogTitle:"",dialogShow:!1,dialogLoading:!1,closeIconShow:!0,tableLoading:!1,searchFrom:{name:"",ip:"",category:"",os:""},tableList:[],runSysList:[],isDropdownShow:!1,pagination:{current:1,count:1,limit:10}}},created:function(){this.handleLoad(),this.getRunSysList(),this.auth=this.hasPerm(this.$route.path),this.maxTableHeight=this.$store.state.common.defaultTableHeight-52},methods:{handleConfim:function(){var e=this;this.dialogLoading=!0,this.$refs.agentDialog.$refs.form.validate().then(function(t){var a={};e.$refs.agentDialog.hostList.some(function(t){return a=t,t.bk_host_innerip===e.$refs.agentDialog.form.ip}),"新增Agent"===e.operationFlag?e.$refs.agentDialog.handleAddAgent(a):e.$refs.agentDialog.handleUpdateAgent(a)}).catch(function(t){e.$cwMessage("输入有误, 请检查您的输入！","warning"),e.dialogLoading=!1})},handleCloseDialog:function(e){e&&this.handleLoad(),this.dialogShow=!1},handleDelete:function(e){var t,a=this;this.$bkInfo({type:"primary",title:"确认要删除吗？",confirmLoading:!1,confirmFn:(t=l()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a.$api.station.delete(e.id).then(function(e){e.result?(a.$cwMessage("删除成功！","success"),1===a.tableList.length&&1!==a.pagination.current&&(a.pagination.current-=1),a.handleLoad()):a.$cwMessage(e.message,"error")});case 1:case"end":return t.stop()}},t,a)})),function(){return t.apply(this,arguments)})})},getRunSysList:function(){this.runSysList=[]},handlePageLimitChange:function(e){this.pagination.current=1,this.pagination.limit=e,this.handleLoad()},handlePageChange:function(e){this.pagination.current=e,this.handleLoad()},handleLoad:function(){var e=this;this.tableLoading=!0,this.$api.station.list(n()({},this.searchFrom,{page:this.pagination.current,page_size:this.pagination.limit})).then(function(t){t.result?(e.pagination.count=t.data.count,e.tableList=t.data.items):e.$cwMessage(t.message,"error"),e.tableLoading=!1})},handleReset:function(){this.searchFrom={name:"",ip:"",category:"",os:""}},handleSearch:function(){this.pagination.current=1,this.handleLoad()},handleOpenDialog:function(e,t){this.agentFrom=t,this.operationFlag=e,this.dialogKey+=1,this.dialogShow=!0,this.dialogTitle=e},handleOpenSeniorSearch:function(){this.isDropdownShow=!this.isDropdownShow}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"agentList"}},[e.auth.create||e.auth.search?a("div",{staticClass:"header"},[e.auth.create?a("div",{staticStyle:{float:"left"}},[a("bk-button",{attrs:{theme:"primary"},on:{click:function(t){return e.handleOpenDialog("新增Agent",{})}}},[e._v("新增Agent")])],1):e._e(),e._v(" "),e.auth.search?a("div",{staticStyle:{float:"right"}},[a("bk-input",{staticStyle:{width:"240px","margin-right":"8px"},attrs:{clearable:"",width:"240px",placeholder:"请输入Agent名称","right-icon":"bk-icon icon-search"},on:{"right-icon-click":e.handleSearch,enter:e.handleSearch},model:{value:e.searchFrom.name,callback:function(t){e.$set(e.searchFrom,"name",t)},expression:"searchFrom.name"}}),e._v(" "),a("bk-button",{attrs:{slot:"dropdown-trigger",theme:!0===e.isDropdownShow?"primary":"default","icon-right":!0===e.isDropdownShow?"angle-double-up":"angle-double-down"},on:{click:e.handleOpenSeniorSearch},slot:"dropdown-trigger"},[e._v("高级搜索")])],1):e._e(),e._v(" "),e.isDropdownShow?a("div",{staticClass:"senior-search-box"},[a("bk-container",{attrs:{margin:0}},[a("bk-form",{attrs:{"label-width":100}},[a("bk-row",[a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"Agent:"}},[a("bk-input",{attrs:{placeholder:"请输入Agent",clearable:""},model:{value:e.searchFrom.name,callback:function(t){e.$set(e.searchFrom,"name",t)},expression:"searchFrom.name"}})],1)],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"IP:"}},[a("bk-input",{attrs:{placeholder:"请输入IP",clearable:""},model:{value:e.searchFrom.ip,callback:function(t){e.$set(e.searchFrom,"ip",t)},expression:"searchFrom.ip"}})],1)],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"跑批系统:"}},[a("bk-select",{staticClass:"header-select",staticStyle:{"background-color":"#fff"},attrs:{clearable:!0},model:{value:e.searchFrom.category,callback:function(t){e.$set(e.searchFrom,"category",t)},expression:"searchFrom.category"}},e._l(e.runSysList,function(e,t){return a("bk-option",{key:t,attrs:{id:e.id,name:e.name}})}),1)],1)],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"操作系统:"}},[a("bk-input",{attrs:{placeholder:"请输入操作系统",clearable:""},model:{value:e.searchFrom.os,callback:function(t){e.$set(e.searchFrom,"os",t)},expression:"searchFrom.os"}})],1)],1)],1),e._v(" "),a("bk-row",{staticStyle:{display:"flex","justify-content":"center","margin-top":"16px"}},[a("bk-button",{attrs:{theme:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),e._v(" "),a("bk-button",{staticStyle:{"margin-left":"8px"},on:{click:e.handleReset}},[e._v("重置")]),e._v(" "),a("bk-button",{staticStyle:{"margin-left":"8px"},on:{click:e.handleOpenSeniorSearch}},[e._v("取消")])],1)],1)],1)],1):e._e()]):e._e(),e._v(" "),a("div",{staticStyle:{clear:"both"}}),e._v(" "),a("div",{staticClass:"content"},[a("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:e.tableList,pagination:e.pagination,"ext-cls":"customTable","max-height":e.maxTableHeight},on:{"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange}},[a("bk-table-column",{attrs:{label:"Agent名称",prop:"name","show-overflow-tooltip":!0}}),e._v(" "),a("bk-table-column",{attrs:{label:"IP",prop:"ip","show-overflow-tooltip":!0}}),e._v(" "),a("bk-table-column",{attrs:{label:"所属业务",prop:"biz_name","show-overflow-tooltip":!0}}),e._v(" "),a("bk-table-column",{attrs:{label:"跑批系统",prop:"category",sortable:"","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e.runSysList.length?a("span",[e._v(e._s(e.runSysList.find(function(e){return e.id===t.row.category}).name))]):e._e()]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:"操作系统",prop:"os",sortable:"","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(""===t.row.os?"- -":t.row.os))])]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:"作业并发限制",prop:"max_concurrency",sortable:"","show-overflow-tooltip":!0}}),e._v(" "),a("bk-table-column",{attrs:{label:"Agent添加时间",prop:"create_time",sortable:"","show-overflow-tooltip":!0}}),e._v(" "),e.auth.del||e.auth.modify?a("bk-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.auth.modify?a("bk-button",{attrs:{text:""},on:{click:function(a){return e.handleOpenDialog("修改Agent",t.row)}}},[e._v("修改\n                    ")]):e._e(),e._v(" "),e.auth.del?a("bk-button",{staticStyle:{"margin-left":"10px"},attrs:{text:""},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除\n                    ")]):e._e()]}}],null,!1,1906002137)}):e._e()],1)],1),e._v(" "),a("div",[a("bk-dialog",{attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:e.dialogTitle,"show-footer":!0,position:{top:50},draggable:!1,width:"500",loading:e.dialogLoading,"close-icon":e.closeIconShow},on:{confirm:e.handleConfim},model:{value:e.dialogShow,callback:function(t){e.dialogShow=t},expression:"dialogShow"}},[a("agent-dialog",{key:e.dialogKey,ref:"agentDialog",attrs:{"operation-flag":e.operationFlag,"agent-from":e.agentFrom},on:{"close-dialog":e.handleCloseDialog}})],1)],1)])},staticRenderFns:[]};var u=a("VU/8")(g,m,!1,function(e){a("zB0V")},"data-v-91939a0c",null);t.default=u.exports},zB0V:function(e,t){}});