webpackJsonp([19],{InCh:function(e,t){},miEv:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Xxa5"),n=i.n(a),s=i("exGp"),r=i.n(s),o=i("s0MJ"),l=i("NYxO"),c={data:function(){var e=[{id:"name",label:"作业流名",overflowTooltip:!0,sortable:!1},{id:"run_type",label:"调度方式",overflowTooltip:!1,sortable:!1},{id:"state",label:"状态",overflowTooltip:!1,sortable:!1},{id:"create_time",label:"创建时间",overflowTooltip:!1,sortable:!0},{id:"total_not_execute_job_count",label:"未执行作业数",overflowTooltip:!1,sortable:!1},{id:"is_release_dependency",label:"是否释放依赖",overflowTooltip:!0,sortable:!0},{id:"eta",label:"计划开始时间",overflowTooltip:!0,sortable:!0},{id:"start_time",label:"实际开始时间",overflowTooltip:!1,sortable:!0},{id:"end_time",label:"完成时间",overflowTooltip:!0,sortable:!0}];return{maxTableHeight:"",setting:{size:"small",fields:e,selectedFields:e.slice(0,4)},opreateFlag:!1,midSearchForm:{},auth:{operate:!1},timer:null,pagination:{current:1,count:1,limit:10},runSysList:[],tableLoading:!1,selectionList:[],tableList:[],searchForm:{name:"",executor:"",process_run_name:"",state:"",station:"",eta:["",""],startTime:["",""],endTime:["",""],confirm_users:"",need_confirm:"",category:""},isDropdownShow:!1,stateList:[{id:1,name:"wait",label:"等待"},{id:2,name:"run",label:"正在执行"},{id:3,name:"fail",label:"失败"},{id:4,name:"error",label:"错误"},{id:5,name:"success",label:"成功"},{id:6,name:"pause",label:"挂起"},{id:7,name:"stop",label:"终止"},{id:8,name:"positive",label:"就绪"},{id:9,name:"cancel",label:"取消"},{id:10,name:"need_confirm",label:"待复核"},{id:11,name:"ignore",label:"忽略"}]}},computed:Object(l.b)(["jobViewSearchForm"]),created:function(){var e=this;this.auth=this.hasPerm(this.$route.path),this.maxTableHeight=this.$store.state.common.defaultTableHeight-143,this.initSearch(),this.getRunSysList(),this.handleLoad(!0),this.timer=setInterval(function(){e.handleLoad(!1)},15e3)},beforeDestroy:function(){clearInterval(this.timer)},methods:{handleSettingChange:function(e){var t=e.fields,i=e.size;this.setting.size=i,this.setting.selectedFields=t},handleEtaChange:function(e){this.searchForm.eta=e},handleStartTimeChange:function(e){this.searchForm.startTime=e},handleEndTimeChange:function(e){this.searchForm.endTime=e},handlePageLimitChange:function(e){this.pagination.current=1,this.pagination.limit=e,this.handleLoad(!0)},handlePageChange:function(e){this.pagination.current=e,this.handleLoad(!0)},handleOperation:function(e){var t=this;if(0===this.selectionList.length)return this.$cwMessage("至少选择一条数据","warning");var i=[];this.selectionList.forEach(function(e){i.indexOf(e.id)<0&&i.push(e.id)});var a,s={pause:{preState:"等待",content:"作业暂停执行，不会继续后面的执行",width:400},resume:{preState:"挂起",content:"恢复挂起作业",width:400},stop:{preState:"进行中",content:"终止后不会继续后面的执行，并且无法恢复。会强制终止此作业",width:550},cancel:{preState:"除了正在执行，忽略，就绪",content:"将作业状态置为取消，可以继续往下执行",width:500},replay:{preState:"已完成、错误、失败，终止、取消",content:"复制一份该作业，并放入原作业流中。如果新的作业成功，那么对作业流就是成功了",width:650},release:{preState:"未执行",content:"释放此作业的被依赖关系（包括时间依赖）",width:400},success:{preState:"错误，失败，终止",content:"针对错误，失败，终止的作业，设置为成功",wdith:400},confirm:{preState:"待复核",content:"针对待复核的作业，设置为等待",width:400}};this.$bkInfo({type:"primary",title:"执行前状态："+s[e].preState,subTitle:"功能说明："+s[e].content,width:s[e].width,confirmLoading:!1,confirmFn:(a=r()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.tableLoading=!0,t.opreateFlag=!0,t.$api.nodeRun.control({event:e,ids:i}).then(function(e){t.loading=!1,e.result?((t.jobViewSearchForm.state||t.jobViewSearchForm.need_confirm)&&(t.selectionList=[]),t.opreateFlag=!1,t.handleLoad(!0),t.$cwMessage("操作成功！","success")):(t.opreateFlag=!1,t.handleLoad(!0),t.$cwMessage(e.message,"error")),t.tableLoading=!1});case 3:case"end":return a.stop()}},a,t)})),function(){return a.apply(this,arguments)})})},handleSelectAll:function(e){var t=this;e.length>0?this.selectionList=this.selectionList.concat(e):this.tableList.forEach(function(e){t.selectionList=t.selectionList.filter(function(t){return t.id!==e.id})})},handleSelect:function(e,t){var i=this.selectionList.find(function(e){return e.id===t.id});i?this.selectionList=this.selectionList.filter(function(e){return e.id!==i.id}):this.selectionList.push(t)},handleCheckDetail:function(e){this.$router.push({path:"/jobdetail",query:{id:e.id}})},handleReset:function(){this.searchForm={name:"",executor:"",process_run_name:"",state:"",station:"",eta:["",""],startTime:["",""],endTime:["",""],confirm_users:"",need_confirm:"",category:""}},handleSearch:function(){this.selectionList=[],this.$store.commit("getJobViewSearch",this.searchForm),this.midSearchForm=Object(o.a)(this.searchForm),this.pagination.current=1,this.handleLoad(!0)},handleOpenSeniorSearch:function(){this.isDropdownShow=!this.isDropdownShow},getRunSysList:function(){this.runSysList=[]},initSearch:function(){var e=this.jobViewSearchForm;e.hasOwnProperty("name")&&(this.searchForm.name=e.name),e.hasOwnProperty("executor")&&(this.searchForm.executor=e.executor),e.hasOwnProperty("eta")&&(this.searchForm.eta[0]=e.eta[0],this.searchForm.eta[1]=e.eta[1]),e.hasOwnProperty("startTime")&&(this.searchForm.startTime[0]=e.startTime[0],this.searchForm.startTime[1]=e.startTime[1]),e.hasOwnProperty("endTime")&&(this.searchForm.endTime[0]=e.endTime[0],this.searchForm.endTime[1]=e.endTime[1]),e.hasOwnProperty("process_run_name")&&(this.searchForm.process_run_name=e.process_run_name),e.hasOwnProperty("need_confirm")&&(this.searchForm.need_confirm=e.need_confirm),e.hasOwnProperty("confirm_users")&&(this.searchForm.confirm_users=e.confirm_users),e.hasOwnProperty("station")&&(this.searchForm.station=e.station),e.hasOwnProperty("category")&&(this.searchForm.category=e.category),e.hasOwnProperty("state")&&(this.searchForm.state=e.state),this.midSearchForm=Object(o.a)(this.searchForm)},defaultCheck:function(){var e=this;this.tableLoading=!0,this.$nextTick(function(){e.selectionList.forEach(function(t){e.tableList.forEach(function(i){t.id===i.id&&e.$refs.table.toggleRowSelection(i,!0)})}),e.tableLoading=!1})},handleLoad:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.opreateFlag)return!1;t&&(this.tableLoading=!0);var i={name:this.midSearchForm.name,executor:this.midSearchForm.executor,eta_gte:this.midSearchForm.eta[0],eta_lte:this.midSearchForm.eta[1],start_time_gte:this.midSearchForm.startTime[0],start_time_lte:this.midSearchForm.startTime[1],end_time_gte:this.midSearchForm.endTime[0],end_time_lte:this.midSearchForm.endTime[1],process_run_name:this.midSearchForm.process_run_name,need_confirm:this.midSearchForm.need_confirm,confirm_users:this.midSearchForm.confirm_users,station_name:this.midSearchForm.station,state:this.midSearchForm.state,category:this.midSearchForm.category,page:this.pagination.current,page_size:this.pagination.limit};this.$route.query.hasOwnProperty("job_flow_id")&&(i.process_run=this.$route.query.job_flow_id),this.$api.nodeRun.list(i).then(function(t){t.result?(e.tableList=t.data.items,e.pagination.count=t.data.count,e.selectionList.length&&e.defaultCheck(),e.tableLoading=!1):(e.$cwMessage(t.message,"error"),e.tableLoading=!1)})}}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"jobView"}},[e.auth.operate||e.auth.search?i("div",{staticClass:"header"},[e.auth.operate?i("div",{staticStyle:{float:"left","font-size":"0"}},[i("bk-button",{staticClass:"operationBtn",on:{click:function(t){return e.handleOperation("pause")}}},[e._v("挂起")]),e._v(" "),i("bk-button",{staticClass:"operationBtn",on:{click:function(t){return e.handleOperation("resume")}}},[e._v("恢复")]),e._v(" "),i("bk-button",{staticClass:"operationBtn",on:{click:function(t){return e.handleOperation("stop")}}},[e._v("终止")])],1):e._e(),e._v(" "),e.auth.search?i("div",{staticStyle:{float:"right"}}):e._e()]):e._e(),e._v(" "),i("div",{staticStyle:{clear:"both"}}),e._v(" "),i("div",{staticClass:"content"},[i("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"table",attrs:{data:e.tableList,pagination:e.pagination,"ext-cls":"customTable",size:e.setting.size,"max-height":e.maxTableHeight},on:{"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange,select:e.handleSelect,"select-all":e.handleSelectAll}},[i("bk-table-column",{attrs:{type:"selection",width:"60"}}),e._v(" "),e._l(e.setting.selectedFields,function(t,a){return i("bk-table-column",{key:a,attrs:{label:t.label,prop:t.id,"show-overflow-tooltip":t.overflowTooltip,sortable:t.sortable},scopedSlots:e._u([{key:"default",fn:function(a){return["name"===t.id?i("div",{staticStyle:{color:"#052150",cursor:"pointer","font-weight":"400","text-decoration":"underline"},on:{click:function(t){return e.handleCheckDetail(a.row)}}},[e._v(e._s(a.row.name))]):"state"===t.id?i("div",[i("bk-tag",{class:a.row.state},[e._v("\n                            "+e._s(e.stateList[e.stateList.findIndex(function(e){return e.name===a.row.state})].label)+"\n                        ")])],1):"run_type"===t.id?i("div",["hand"===a.row.run_type?i("span",[i("bk-tag",{attrs:{radius:"5px"}},[e._v("单次")])],1):"time"===a.row.run_type?i("span",[i("bk-tag",{attrs:{radius:"5px"}},[e._v("定时")])],1):"cycle"===a.row.run_type?i("span",[i("bk-tag",{attrs:{radius:"5px"}},[e._v("周期")])],1):"calendar"===a.row.run_type?i("span",[i("bk-tag",{attrs:{radius:"5px"}},[e._v("日历")])],1):e._e()]):i("div",[i("span",[e._v(e._s(""===a.row[t.id]||null===a.row[t.id]?"- -":a.row[t.id]))])])]}}],null,!0)})}),e._v(" "),i("bk-table-column",{attrs:{type:"setting"}},[i("bk-table-setting-content",{attrs:{fields:e.setting.fields,selected:e.setting.selectedFields,size:e.setting.size},on:{"setting-change":e.handleSettingChange}})],1)],2)],1)])},staticRenderFns:[]};var d=i("VU/8")(c,h,!1,function(e){i("InCh")},"data-v-c6a0d87a",null);t.default=d.exports}});