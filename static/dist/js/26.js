webpackJsonp([26],{TQTP:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("Xxa5"),n=i.n(s),a=i("exGp"),r=i.n(a),o={data:function(){return{imgSrc:"",loading:!1,sysForm:[],edit_sysForm:[],isEdit:!1,reg:"",re:"",resultVerify:""}},created:function(){this.get_setup(),this.getLogo()},methods:{verifyData:function(t){"BKAPP_CMDB_IP"===t.key?(this.reg=/^((\d)|([1-9]\d)|(1\d{2})|((2[0-4]\d)|(25[0-5])))(\.((\d)|([1-9]\d)|(1\d{2})|((2[0-4]\d)|(25[0-5])))){3}$/,this.re=new RegExp(this.reg)):"BKAPP_CMDB_PORT"===t.key?(this.reg=/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/,this.re=new RegExp(this.reg)):"BKAPP_SUPPLIER_ACCOUNT"===t.key?(this.reg=/^[1-9]\d*|0$/,this.re=new RegExp(this.reg)):"BKAPP_CMDB_API_VERSION"===t.key?(this.reg=/^[A-Za-z0-9]+$/,this.re=new RegExp(this.reg)):"DAILY_TIME"===t.key&&(this.reg=/^[0-9]*$/,this.re=new RegExp(this.reg)),this.alertInfo(t.value)},alertInfo:function(t){return this.re.test(t)?(this.resultVerify=!0,this.resultVerify):(this.$bkMessage({theme:"warning",message:"请填写合法信息！ ",limit:1}),this.resultVerify=!1,this.resultVerify)},get_setup:function(){var t=this;this.isEdit=!1,this.loading=!0,this.$api.setting.list().then(function(e){t.loading=!1,e.result?(t.sysForm=e.data.items,t.edit_sysForm=t.sysForm):t.$cwMessage(e.message,"error")})},handleSave:function(t){var e=this;for(var i in this.loading=!0,this.edit_sysForm){if(null===this.edit_sysForm[i].value||""===this.edit_sysForm[i].value)return this.$bkMessage({theme:"warning",message:this.edit_sysForm[i].description+"不可为空！ ",delay:0}),!1;this.loading=!1}this.resultVerify?this.$api.setting.batch_update(this.edit_sysForm).then(function(t){e.loading=!1,t.result?(e.get_setup(),e.$cwMessage("保存成功！","success"),e.isEdit=!1):e.$cwMessage(t.message,"error")}):(this.loading=!1,this.$cwMessage("请输入有效数据！","warning"))},uploadLogo:function(){document.getElementById("uploadFile").value="",document.getElementById("uploadFile").click()},uploadFile:function(){var t=this,e={headers:{"Content-Type":"multipart/form-data"}},i=document.getElementById("uploadFile").files[0],s=["png","jpg","jpeg"];if(i.size/1024/1024<50){for(var n=!0,a=0;a<s.length;a++)if(s[a]===i.name.split(".")[i.name.split(".").length-1].toString()){n=!1,this.fileData=new FormData,this.fileData.append("file",i),this.fileData.append("flag",!0),this.loading=!0,this.$api.setting.update_logo(this.fileData,e).then(function(e){t.loading=!1,e.result?(t.$cwMessage("上传成功！","success"),setTimeout(function(){window.location.reload()},200)):t.$cwMessage(e.message,"error")});break}n&&this.$cwMessage("请上传支持的文件格式(png,jpg,jpeg)！","error")}else this.$cwMessage("请上传50M大小以内的文件！","error")},init_logo:function(){var t,e=this;this.$bkInfo({type:"primary",title:"确定恢复默认吗？",confirmLoading:!1,confirmFn:(t=r()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.loading=!0,e.$api.setting.reset_logo().then(function(t){e.loading=!1,t.result?(e.$cwMessage("恢复成功","success"),setTimeout(function(){window.location.reload()},200)):e.$cwMessage(t.message,"error")});case 2:case"end":return t.stop()}},t,e)})),function(){return t.apply(this,arguments)})})},getLogo:function(){var t=this;this.$api.setting.get_logo().then(function(e){e.result&&(t.imgSrc="data:image/png;base64,"+e.data.logo)})}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],attrs:{id:"sysSetup"}},[i("div",{staticClass:"card card-log"},[i("p",{staticClass:"title"},[t._v("Logo设置")]),t._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"img"},[i("img",{attrs:{src:t.imgSrc}})]),t._v(" "),i("input",{staticStyle:{display:"none"},attrs:{id:"uploadFile",type:"file"},on:{change:function(e){return t.uploadFile()}}}),t._v(" "),i("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"primary"},on:{click:function(e){return t.uploadLogo()}}},[t._v("选择图片")]),t._v(" "),i("bk-button",{staticStyle:{"margin-right":"20px"},on:{click:function(e){return t.init_logo()}}},[t._v("恢复默认")]),t._v(" "),i("div",{staticClass:"info"},[i("bk-icon",{staticStyle:{color:"#3A84FF","margin-right":"2px"},attrs:{type:"info-circle-shape"}}),t._v(" "),i("span",{staticStyle:{color:"#979BA5"}},[t._v("仅支持上传 png、jpg、jpeg 格式的图片，建议上传图片宽高比1:1。")])],1)],1)]),t._v(" "),i("div",{staticClass:"card card-sys"},[i("p",{staticClass:"title"},[t._v("系统设置")]),t._v(" "),i("div",{staticClass:"content"},[i("bk-form",[t._l(t.sysForm,function(e,s){return"system_logo"!==e.key?i("bk-form-item",{key:s,attrs:{label:e.description}},[i("bk-input",{attrs:{disabled:!t.isEdit},on:{input:function(i){return t.verifyData(e)}},model:{value:t.edit_sysForm[s].value,callback:function(e){t.$set(t.edit_sysForm[s],"value",e)},expression:"edit_sysForm[index].value"}})],1):t._e()}),t._v(" "),t.isEdit?t._e():i("bk-form-item",[i("bk-button",{attrs:{theme:"primary"},on:{click:function(e){t.isEdit=!0}}},[t._v("修改")])],1),t._v(" "),t.isEdit?i("bk-form-item",{staticStyle:{"font-size":"0"}},[i("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"primary"},on:{click:t.handleSave}},[t._v("保存")]),t._v(" "),i("bk-button",{on:{click:function(e){return t.get_setup()}}},[t._v("取消")])],1):t._e()],2)],1)])])},staticRenderFns:[]};var c=i("VU/8")(o,l,!1,function(t){i("au4L")},"data-v-553138e0",null);e.default=c.exports},au4L:function(t,e){}});