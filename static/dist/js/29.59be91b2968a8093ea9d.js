webpackJsonp([29],{fFEI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),r=a.n(n),i={data:function(){return{disabled:!1,varChangeLoading:!1,variableTypeList:[{id:1,label:"普通变量",value:"common"},{id:2,label:"敏感变量",value:"sensitive"}],tableList:[],form:{name:"",description:""},rules:{name:[{required:!0,message:"变量表名不能为空",trigger:"change"}]}}},created:function(){"add"!==this.$route.query.type&&(this.handleLoad(),"detail"===this.$route.query.type&&(this.disabled=!0))},methods:{handleLoad:function(){var e=this;this.varChangeLoading=!0,this.$api.varTable.retrieve(parseInt(this.$route.query.id)).then(function(t){if(t.result){var a=t.data;e.tableList=a.data.map(function(e){return{type:e.type,name:e.name,value:e.value,edit:!1}}),e.form.name=a.name,e.form.description=a.description}else e.$cwMessage(t.message,"error");e.varChangeLoading=!1})},handleConfim:function(){var e=this;this.$refs.form.validate().then(function(t){if(0===e.tableList.length)return e.$cwMessage("至少新增一条变量！","warning");if(e.tableList.some(function(e){return!0===e.edit}))return e.$cwMessage("请补充完整表格数据后锁定确认！","warning");var a=r()({},e.form,{data:e.tableList.map(function(e){return{type:e.type,name:e.name,value:e.value}})});"add"===e.$route.query.type?e.handleSaveAdd(a):e.handleSaveUpdate(a)}).catch(function(t){e.$cwMessage("您的输入有误，请检查输入！","warning")})},handleSaveAdd:function(e){var t=this;this.varChangeLoading=!0,this.$api.varTable.create(e).then(function(e){e.result?(t.$cwMessage("新增成功！","success"),t.$router.push({path:"/variablemgmt"})):t.$cwMessage(e.message,"error"),t.varChangeLoading=!1})},handleSaveUpdate:function(e){var t=this;this.varChangeLoading=!0,this.$api.varTable.update(parseInt(this.$route.query.id),e).then(function(e){e.result?(t.$cwMessage("修改成功！","success"),t.$router.push({path:"/variablemgmt"})):t.$cwMessage(e.message,"error"),t.varChangeLoading=!1})},handleCancel:function(){this.$router.go(-1)},handleLock:function(e){return""===e.type?this.$cwMessage("变量类型不能为空！","warning"):""===e.name?this.$cwMessage("变量名不能为空！","warning"):""===e.value?this.$cwMessage("变量值不能为空！","warning"):void(e.edit=!1)},handleAdd:function(){this.tableList.push({type:"",name:"",value:"",edit:!0})},handleDelete:function(e){this.tableList.splice(e,1)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.varChangeLoading,zIndex:10},expression:"{ isLoading: varChangeLoading, zIndex: 10 }"}],attrs:{id:"varChange"}},[a("bk-form",{ref:"form",attrs:{"ext-cls":"costum-form",model:e.form,rules:e.rules,"label-width":90}},[a("bk-form-item",{attrs:{label:"变量表名:","error-display-type":"normal",required:!0,property:"name"}},[a("bk-input",{attrs:{disabled:e.disabled},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"描述:",required:!0}},[a("bk-input",{attrs:{disabled:e.disabled},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),a("bk-form-item",[a("bk-table",{ref:"table",attrs:{data:e.tableList,"ext-cls":"customTable"}},[a("bk-table-column",{attrs:{label:"变量类型",prop:"type","show-overflow-tooltip":!0,align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("bk-select",{staticStyle:{"background-color":"#fff"},model:{value:t.row.type,callback:function(a){e.$set(t.row,"type",a)},expression:"props.row.type"}},e._l(e.variableTypeList,function(e){return a("bk-option",{key:e.id,attrs:{id:e.value,name:e.label}})}),1):a("div",["common"===t.row.type?a("span",[e._v("普通变量")]):e._e(),e._v(" "),"sensitive"===t.row.type?a("span",[e._v("敏感变量")]):e._e()])]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:"变量名",prop:"name","show-overflow-tooltip":!0,align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("bk-input",{attrs:{placeholder:"请输入变量名, ${变量}"},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"props.row.name"}}):a("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("bk-table-column",{attrs:{label:"变量值",prop:"value","show-overflow-tooltip":!0,align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?a("bk-input",{model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"props.row.value"}}):a("div",["sensitive"!==t.row.type?a("span",[e._v(e._s(t.row.value))]):a("bk-tag",{attrs:{theme:"danger"}},[e._v("保密数据")])],1)]}}])}),e._v(" "),"detail"!==e.$route.query.type?a("bk-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.edit?e._e():a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(e){t.row.edit=!t.row.edit}}},[e._v("解锁")]),e._v(" "),t.row.edit?a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(a){return e.handleLock(t.row)}}},[e._v("锁定")]):e._e(),e._v(" "),a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(a){return e.handleDelete(t.$index)}}},[e._v("删除\n                        ")])]}}],null,!1,3922934669)}):e._e()],1),e._v(" "),"detail"!==e.$route.query.type?a("div",{staticClass:"addBtn",staticStyle:{"text-align":"center"}},[a("bk-button",{staticStyle:{width:"120px","font-size":"12px"},attrs:{theme:"default",title:"新增",icon:"plus"},on:{click:e.handleAdd}},[e._v("新增")])],1):e._e()],1),e._v(" "),a("bk-form-item",{staticStyle:{"font-size":"0px"}},["detail"!==e.$route.query.type?a("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"primary"},on:{click:e.handleConfim}},[e._v("确定")]):e._e(),e._v(" "),"detail"!==e.$route.query.type?a("bk-button",{on:{click:e.handleCancel}},[e._v("取消")]):e._e()],1)],1)],1)},staticRenderFns:[]};var s=a("VU/8")(i,o,!1,function(e){a("v0ja")},"data-v-540da88d",null);t.default=s.exports},v0ja:function(e,t){}});