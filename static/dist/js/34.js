webpackJsonp([34],{GcMB:function(e,t){},zcDg:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("mvHQ"),o=r.n(i),a=r("Xxa5"),s=r.n(a),n=r("exGp"),l=r.n(n),c=r("woOf"),d=r.n(c),u=r("s0MJ"),m=r("VzGs"),p=r("07G5"),f={components:{editor:m.a,nodeInfo:p.a},data:function(){return{customSettings:{isShow:!1,title:"更多参数配置"},headerHolder:'请输入请求头, 例如： {"Content-type": "application/json"}',paramsHolder:'请输入填写请求体, 例如： {"name": "abc"}',checkFlag:!0,overScreenFlag:!1,pageKey:0,agnetListShow:!0,accountListShow:!0,formLoading:!1,disabled:!1,timeTypeList:[{value:"hours",label:"时"},{value:"minutes",label:"分"},{value:"seconds",label:"秒"}],reviewList:[{label:"正常运行",value:1},{label:"禁止运行",value:0}],scriptMap:{1:"shell",2:"bat",3:"perl",4:"python",5:"powershell",8:"sql",9:"json"},sqlTypeList:[{key:"MySQL",label:"MySQL"},{key:"Oracle",label:"Oracle"}],httpReqTypeList:[{key:"get",label:"GET"},{key:"post",label:"POST"},{key:"put",label:"PUT"},{key:"delete",label:"DELETE"}],scriptTypeList:[{key:1,label:"Shell(Linux)",value:"shell-linux-1"},{key:2,label:"Bat(Windows)",value:"bat-win-2"},{key:3,label:"perl",value:"perl-3"},{key:4,label:"Python(Linux)",value:"python-linux-4"},{key:5,label:"PowerShell(Windows)",value:"powershell-win-5"},{key:6,label:"HTTP",value:"HTTP"}],accountList:[],runSysList:[],agentList:[],form:{name:"",description:"",category:"",station:"",os:"",exit_code:"",data:{account:"",script_type:1,script_content:"",script_timeout:8600,request_type:"",request_url:"",headers:"",params:""},outputs:[{key:"_result",name:"执行结果",reference:1},{key:"_log_outputs",name:"作业输出变量",reference:0}],coding:"class Task:\n    def execute(self):\n        pass"},cloneForm:{},otherRules:{"data.script_content":[{required:!0,message:"脚本内容不能为空",trigger:"blur"}]},baseRules:{name:[{required:!0,message:"作业名称不能为空",trigger:"blur"}],description:[{required:!0,message:"作业描述不能为空",trigger:"blur"}],category:[{required:!0,message:"跑批系统不能为空",trigger:"change"}],station:[{required:!0,message:"agent不能为空",trigger:"change"}],"data.account":[{required:!0,message:"执行账号不能为空",trigger:"change"}],"data.script_type":[{required:!0,message:"脚本类型不能为空",trigger:"change"}],"data.script_timeout":[{required:!0,message:"超时时间不能为空",trigger:"blur"}]}}},computed:{rules:function(){var e={};return d()(e,this.baseRules,this.otherRules),e},nodeData:function(){return{data:this.cloneForm}}},watch:{},created:function(){"update"===this.$route.query.type||"clone"===this.$route.query.type?this.initJobData():this.pageKey+=1},mounted:function(){var e=this,t=r("uk2G")();this.$nextTick(function(){t.listenTo(document.getElementById("singleJob"),function(t){t.offsetHeight-(document.documentElement.clientHeight-52)>0?e.overScreenFlag=!0:e.overScreenFlag=!1})})},beforeRouteLeave:function(e,t,r){var i,o=this;this.checkFlag?this.$bkInfo({type:"warning",width:480,title:"该操作会导致您的编辑无保存, 确认吗？",confirmLoading:!1,confirmFn:(i=l()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r();case 1:case"end":return e.stop()}},e,o)})),function(){return i.apply(this,arguments)})}):r()},methods:{handleAddJob:function(){var e=this;this.formLoading=!0;var t=Object(u.a)(this.form);t.inputs_component=this.$refs.editor1.monacoEditor.getValue(),t.inputs=this.$refs.editor2.monacoEditor.getValue(),t.coding=this.$refs.editor3.monacoEditor.getValue(),this.$api.content.create(t).then(function(t){t.result?(e.checkFlag=!1,e.$cwMessage("创建成功！","success"),e.$router.push({path:"/joblist"})):e.$cwMessage(t.message,"error"),e.formLoading=!1})},handleUpdateJob:function(){var e=this;this.formLoading=!0;var t=parseInt(this.$route.query.job_id),r=Object(u.a)(this.form);r.inputs_component=this.$refs.editor1.monacoEditor.getValue(),r.inputs=this.$refs.editor2.monacoEditor.getValue(),r.coding=this.$refs.editor3.monacoEditor.getValue(),this.$api.content.update(t,r).then(function(t){t.result?(e.checkFlag=!1,e.$cwMessage("更新成功！","success"),e.$router.push({path:"/joblist"})):e.$cwMessage(t.message,"error"),e.formLoading=!1})},handleCloneJob:function(){var e=this;this.formLoading=!0;var t=Object(u.a)(this.form);this.$api.content.clone(t).then(function(t){t.result?(e.$cwMessage("克隆成功！","success"),e.$router.push({path:"/joblist"})):e.$cwMessage(t.message,"error"),e.formLoading=!1})},handleConfim:function(){var e=this;this.$refs.form.validate().then(function(t){"add"===e.$route.query.type?e.handleAddJob():"update"===e.$route.query.type?e.handleUpdateJob():"clone"===e.$route.query.type&&e.handleAddJob()}).catch(function(e){})},handleCancel:function(){this.$router.go(-1)},handlePreView:function(){this.cloneForm=Object(u.a)(this.form),console.log(this.form),this.cloneForm.inputs_component=this.$refs.editor1.monacoEditor.getValue(),this.cloneForm.inputs=this.$refs.editor2.monacoEditor.getValue(),this.cloneForm.outputs=o()(this.form.outputs),this.customSettings.isShow=!0},setDefaultEditor:function(e,t,r){this.$refs.editor1.changeModel(this.scriptMap[e],t),this.$refs.editor2.changeModel(this.scriptMap[e],r)},initJobData:function(){var e=this;this.formLoading=!0;var t=parseInt(this.$route.query.job_id);this.$api.content.retrieve(t).then(function(t){t.result?(e.form=t.data,e.setDefaultEditor(1,o()(e.form.inputs_component),o()(e.form.inputs)),e.$refs.editor3.changeModel("python",e.form.coding)):e.$cwMessage(t.message,"error"),e.formLoading=!1})}}},b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.formLoading,zIndex:10},expression:"{ isLoading: formLoading, zIndex: 10 }"}],attrs:{id:"singleJob"}},[r("div",{staticClass:"wrapper"},[r("bk-container",{attrs:{col:12,gutter:4}},[r("bk-row",[r("bk-col",{attrs:{span:8}},[r("div",{staticClass:"job-content content"},[r("p",{staticClass:"job-title"},[e._v("自定义节点")]),e._v(" "),r("bk-form",{ref:"form",attrs:{"label-width":144,model:e.form}},[r("bk-form-item",{attrs:{label:"节点名称:",required:!0,"error-display-type":"normal",property:"node_name"}},[r("bk-input",{staticStyle:{width:"350px","margin-right":"9px"},attrs:{type:"text",disabled:e.disabled},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("bk-form-item",{attrs:{label:"运行标志:",required:!0,"error-display-type":"normal",property:"run_mark"}},[r("bk-radio-group",{model:{value:e.form.run_mark,callback:function(t){e.$set(e.form,"run_mark",t)},expression:"form.run_mark"}},e._l(e.reviewList,function(t,i){return r("bk-radio",{key:i,staticStyle:{"margin-right":"24px"},attrs:{value:t.value,disabled:e.disabled}},[e._v("\n                                        "+e._s(t.label)+"\n                                    ")])}),1)],1),e._v(" "),r("bk-form-item",{attrs:{label:"描述:"}},[r("bk-input",{staticStyle:{width:"350px","margin-right":"9px"},attrs:{type:"textarea",disabled:e.disabled,min:0},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),r("bk-form-item",{attrs:{label:"失败重试次数:",required:!0,"error-display-type":"normal",property:"fail_retry_count"}},[r("bk-input",{staticStyle:{width:"350px","margin-right":"9px"},attrs:{type:"number",disabled:e.disabled,min:0},model:{value:e.form.fail_retry_count,callback:function(t){e.$set(e.form,"fail_retry_count",t)},expression:"form.fail_retry_count"}})],1),e._v(" "),r("bk-form-item",{attrs:{label:"失败重试间隔:"}},[r("bk-compose-form-item",[r("bk-input",{staticStyle:{width:"139px","margin-right":"9px"},attrs:{type:"number",disabled:e.disabled,min:0},model:{value:e.form.fail_offset,callback:function(t){e.$set(e.form,"fail_offset",t)},expression:"form.fail_offset"}}),e._v(" "),r("bk-select",{staticStyle:{"background-color":"#fff",width:"138px","margin-right":"14px"},attrs:{clearable:!0,placeholder:"请选择",disabled:e.disabled},model:{value:e.form.fail_offset_unit,callback:function(t){e.$set(e.form,"fail_offset_unit",t)},expression:"form.fail_offset_unit"}},e._l(e.timeTypeList,function(e,t){return r("bk-option",{key:t,attrs:{id:e.value,name:e.label}})}),1),e._v(" "),r("span",[e._v("产生重试")])],1)],1),e._v(" "),r("bk-form-item",{attrs:{label:"忽略失败:"}},[r("bk-switcher",{attrs:{disabled:e.disabled},model:{value:e.form.is_skip_fail,callback:function(t){e.$set(e.form,"is_skip_fail",t)},expression:"form.is_skip_fail"}})],1),e._v(" "),r("bk-form-item",{attrs:{label:"超时告警:"}},[r("bk-switcher",{attrs:{disabled:e.disabled},model:{value:e.form.is_timeout_alarm,callback:function(t){e.$set(e.form,"is_timeout_alarm",t)},expression:"form.is_timeout_alarm"}})],1),e._v(" "),r("bk-divider",{staticStyle:{width:"100%",position:"relative",right:"20px","border-color":"#dcdee5"}}),e._v(" "),r("p",{staticClass:"job-title"},[e._v("输入参数")]),e._v(" "),r("bk-form-item",{attrs:{label:"表单组件: "}},[r("editor",{ref:"editor1",attrs:{height:"200px",codes:JSON.stringify(e.form.inputs_component),"read-only":!1,language:"shell"}})],1),e._v(" "),r("bk-form-item",{attrs:{label:"默认值: "}},[r("editor",{ref:"editor2",attrs:{height:"200px",codes:JSON.stringify(e.form.inputs),"read-only":!1,language:"shell"}})],1),e._v(" "),r("bk-divider",{staticStyle:{width:"100%",position:"relative",right:"20px","border-color":"#dcdee5"}}),e._v(" "),r("div",{staticClass:"box"},[r("p",{staticClass:"job-title",staticStyle:{"margin-bottom":"10px"}},[e._v("输出参数")]),e._v(" "),r("bk-form",[r("bk-table",{attrs:{data:e.form.outputs}},[r("bk-table-column",{attrs:{label:"名称",prop:"name","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[r("bk-input",{model:{value:t.row.name,callback:function(r){e.$set(t.row,"name",r)},expression:"props.row.name"}})]}}])}),e._v(" "),r("bk-table-column",{attrs:{label:"KEY",prop:"key","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[r("bk-input",{model:{value:t.row.key,callback:function(r){e.$set(t.row,"key",r)},expression:"props.row.key"}})]}}])}),e._v(" "),r("bk-table-column",{attrs:{label:"引用",prop:"reference"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("bk-checkbox",{attrs:{disabled:e.disabled,"true-value":1,"false-value":0},model:{value:t.row.reference,callback:function(r){e.$set(t.row,"reference",r)},expression:"props.row.reference"}})]}}])})],1)],1)],1),e._v(" "),r("bk-divider",{staticStyle:{width:"100%",position:"relative",right:"20px","border-color":"#dcdee5"}}),e._v(" "),r("p",{staticClass:"job-title",staticStyle:{"margin-bottom":"10px"}},[e._v("执行代码")]),e._v(" "),r("bk-form-item",{attrs:{label:"后端逻辑: "}},[r("editor",{ref:"editor3",attrs:{height:"200px",codes:e.form.coding,"read-only":!1,language:"python"}})],1)],1)],1)]),e._v(" "),r("bk-col",{attrs:{span:4}},[r("div",{staticClass:"job-content"},[r("p",{staticClass:"job-title"},[e._v("帮助文档：")]),e._v(" "),r("div",[e._v("支持的表单类型：")]),e._v(" "),r("div",[r("div",[e._v("文本类型：")]),e._v(" "),r("div",[e._v('{\n                                "key": "url",\n                                "type": "text",\n                                "label": "请求地址"\n                                }')])]),e._v(" "),r("div",[r("div",[e._v("长文本类型：")]),e._v(" "),r("div",[e._v('{\n                                "key": "url",\n                                "type": "textarea",\n                                "label": "请求地址"\n                                }')])]),e._v(" "),r("div",[r("div",[e._v("下拉框类型：")]),e._v(" "),r("div",[e._v('{\n                                "key": "method",\n                                "type": "select",\n                                "label": "请求类型：",\n                                "choices": [\n                                {\n                                "label": "GET",\n                                "value": "get"\n                                }\n                                ]\n                                }')])]),e._v(" "),r("div",[r("div",[e._v("字典类型：")]),e._v(" "),r("div",[e._v('{\n                                "key": "header",\n                                "type": "dict_map",\n                                "label": "Header"\n                                }')])]),e._v(" "),r("div",[r("div",[e._v("数字类型：")]),e._v(" "),r("div",[e._v('{\n                                "key": "timeout",\n                                "type": "number",\n                                "label": "超时时间："\n                                }')])])])])],1)],1)],1),e._v(" "),r("bk-sideslider",{attrs:{"is-show":e.customSettings.isShow,"quick-close":!0,width:536,title:"预览"},on:{"update:isShow":function(t){return e.$set(e.customSettings,"isShow",t)},"update:is-show":function(t){return e.$set(e.customSettings,"isShow",t)}}},[r("node-info",{attrs:{slot:"content","node-data":e.nodeData,"is-show-btn":!1},slot:"content"})],1),e._v(" "),e.overScreenFlag?[r("div",{staticStyle:{height:"72px"}}),e._v(" "),r("div",{staticClass:"footer"},[r("bk-button",{staticStyle:{margin:"0 10px 0 140px"},attrs:{theme:"primary"},on:{click:e.handleConfim}},[e._v("确定")]),e._v(" "),r("bk-button",{staticStyle:{"margin-right":"10px"},on:{click:e.handleCancel}},[e._v("取消")]),e._v(" "),r("bk-button",{on:{click:e.handlePreView}},[e._v("预览")])],1)]:e._e()],2)},staticRenderFns:[]};var h=r("VU/8")(f,b,!1,function(e){r("GcMB")},"data-v-245fd982",null);t.default=h.exports}});