webpackJsonp([4],{"+ByC":function(e,t){},"4d6r":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),i=a.n(n),s=a("VzGs"),o=a("s0MJ"),l=a("KMyz"),r=a("Ns9M"),d=[{label:"成功",key:"success",fill:"#2DCB56"},{label:"正在执行",key:"run",fill:"#3A84FF"},{label:"失败",key:"fail",fill:"#FF9C01"},{label:"终止",key:"stop",fill:"#A60505"},{label:"错误",key:"error",fill:"#EA3636"},{label:"等待",key:"wait",fill:"#FFFFFF"},{label:"就绪",key:"positive",fill:"#94F5A4"},{label:"忽略",key:"ignore",fill:"#aa557f"},{label:"挂起",key:"pause",fill:"#FD9C9C"},{label:"取消",key:"cancel",fill:"#C4C6CC"},{label:"待复核",key:"need_confirm",fill:"#aa55ff"},{label:"正在执行（存在审核）",key:"exists_need_confirm",fill:"#ffaaff"},{label:"正在执行（存在错误）",key:"exists_error",fill:"#ff0000"},{label:"正在执行（存在失败）",key:"exists_fail",fill:"#c30d0d"},{label:"正在执行（存在终止）",key:"exists_stop",fill:"#5500ff"},{label:"正在执行（存在挂起）",key:"exists_pause",fill:"#00557f"}],m={data:function(){return{statusList:d}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"statusList"}},[a("ul",e._l(e.statusList,function(t,n){return a("li",{key:n,staticClass:"status-box",staticStyle:{"background-color":""}},[a("span",{staticClass:"left-color",class:["wait"===t.key?"left-color-border":""],style:{backgroundColor:t.fill}}),e._v(" "),a("span",{staticClass:"right-text"},[e._v(e._s(t.label))])])}),0)])},staticRenderFns:[]};var c=a("VU/8")(m,f,!1,function(e){a("7Xq6")},"data-v-ff36d496",null).exports,_=a("fZjL"),p=a.n(_),b={components:{editor:s.a},props:{nodeData:{type:Object,default:function(){}}},data:function(){return{statusList:d,disabled:!0,controlType:"",tableList:[{name:"执行结果",key:"_result",reference:"1"},{name:"作业输出变量",key:"_log_outputs",reference:"2"}],reviewList:[{label:"无",value:0},{label:"单人复核",value:1},{label:"双人复核",value:2}],timeTypeList:[{value:"hours",label:"时"},{value:"minutes",label:"分"},{value:"seconds",label:"秒"}],form:{nodeData:{alarm_policy:{duration:{period:"",unit:""},time_point:""},eta:"",is_book_pause:!1,need_confirm:"",pre_commands:[{key:"",value:""}]}},log:"",state:"",start_time:"",end_time:"",script_content:""}},computed:{getUnit1:function(){var e=this,t=this.timeTypeList.find(function(t){return t.value===e.form.nodeData.alarm_policy.duration.unit});return t?t.label:""},getUnit2:function(){var e=this,t=this.timeTypeList.find(function(t){return t.value===e.form.nodeData.file_dependence.cycle.type});return t?t.label:""}},created:function(){this.form.nodeData=this.nodeData.data,p()(this.form.nodeData.file_dependence).length||(this.form.nodeData.file_dependence={file_path:"",max_num:"",cycle:{type:"",value:""}}),this.form.log=this.nodeData.log,this.form.state=this.nodeData.state,this.form.start_time=this.nodeData.start_time,this.form.end_time=this.nodeData.end_time,this.form.script_content=this.nodeData.script_content,0===this.form.nodeData.pre_commands.length&&(this.form.pre_commands=[{key:"",value:""}])}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"nodeInfo"}},[a("div",{staticClass:"content"},[a("div",{staticClass:"box"},[a("p",{staticClass:"title"},[e._v("基本信息")]),e._v(" "),a("div",{staticClass:"info"},[a("bk-form",{ref:"form",attrs:{"label-width":144}},[a("bk-form-item",{attrs:{label:"开始时间:"}},[a("span",[e._v(e._s(e.form.nodeData.eta))])]),e._v(" "),a("bk-form-item",{attrs:{label:"执行前人工复核:"}},[0===e.form.nodeData.need_confirm?a("span",[e._v("无")]):1===e.form.nodeData.need_confirm?a("span",[e._v("单人复核")]):2===e.form.nodeData.need_confirm?a("span",[e._v("双人复核")]):e._e()]),e._v(" "),a("bk-form-item",{attrs:{label:"执行后自动暂停:"}},[a("bk-switcher",{attrs:{theme:"primary",disabled:e.disabled},model:{value:e.form.nodeData.is_book_pause,callback:function(t){e.$set(e.form.nodeData,"is_book_pause",t)},expression:"form.nodeData.is_book_pause"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"执行时长告警:"}},[a("bk-compose-form-item",[a("span",[e._v(e._s(e.form.nodeData.alarm_policy.duration.period))]),e._v(" "),a("span",[e._v(e._s(e.getUnit1))]),e._v(" "),e.form.nodeData.alarm_policy.duration.period&&e.getUnit1?a("span",[e._v("产生告警")]):e._e()])],1),e._v(" "),a("bk-form-item",{attrs:{label:"执行时间点告警:"}},[e.form.nodeData.alarm_policy.time_point?a("span",{staticStyle:{"margin-right":"12px"}},[e._v("时间点超过")]):e._e(),e._v(" "),a("span",[e._v(e._s(e.form.nodeData.alarm_policy.time_point))]),e._v(" "),e.form.nodeData.alarm_policy.time_point?a("span",[e._v("产生告警")]):e._e()]),e._v(" "),a("bk-form-item",{attrs:{label:"前置文件路径:"}},[a("span",[e._v(e._s(e.form.nodeData.file_dependence.file_path))])]),e._v(" "),a("bk-form-item",{attrs:{label:"巡检次数:"}},[a("span",[e._v(e._s(e.form.nodeData.file_dependence.max_num))])]),e._v(" "),a("bk-form-item",{attrs:{label:"巡检周期:"}},[a("span",[e._v(e._s(e.form.nodeData.file_dependence.cycle.value))]),e._v(" "),a("span",[e._v(e._s(e.getUnit2))])]),e._v(" "),a("bk-form-item",{attrs:{label:"前置条件检测命令:"}},e._l(e.form.nodeData.pre_commands,function(t,n){return a("div",{key:n,staticClass:"pre-commands",staticStyle:{"margin-bottom":"12px"}},[a("span",[e._v(e._s(t.key))])])}),0),e._v(" "),a("bk-form-item",{attrs:{label:"状态:"}},[e._v(e._s(e.statusList[e.statusList.findIndex(function(t){return t.key===e.form.state})].label))]),e._v(" "),a("bk-form-item",{attrs:{label:"执行时间:"}},[e._v(e._s(e.form.start_time))]),e._v(" "),a("bk-form-item",{attrs:{label:"结束时间:"}},[e._v(e._s(e.form.end_time))]),e._v(" "),a("bk-form-item",{attrs:{label:"执行脚本:"}},[a("editor",{ref:"editor",attrs:{height:"200px",codes:e.form.script_content,"read-only":!0,language:"shell"}})],1),e._v(" "),a("bk-form-item",{attrs:{label:"执行日志:"}},[e._v(e._s(e.form.log))])],1)],1)])])])},staticRenderFns:[]};var v={components:{statusList:c,nodeInfo:a("VU/8")(b,u,!1,function(e){a("+ByC")},"data-v-01ada657",null).exports,editor:s.a},data:function(){return{nodeSliderKey:0,form:{},graph:null,mainLoading:!1,tooltip:null,cfg:{},nodeDrawer:{title:"",show:!1,width:496},nodeData:{},stateList:[{id:1,name:"wait",label:"等待"},{id:2,name:"run",label:"正在执行"},{id:3,name:"fail",label:"失败"},{id:4,name:"error",label:"错误"},{id:5,name:"success",label:"成功"},{id:6,name:"pause",label:"挂起"},{id:7,name:"cancel",label:"取消"},{id:8,name:"positive",label:"就绪"},{id:9,name:"stop",label:"终止"},{id:10,name:"need_confirm",label:"待审核"},{id:11,name:"ignore",label:"忽略"},{id:12,name:"exists_need_confirm",label:"正在执行（存在审核）"},{id:13,name:"exists_error",label:"正在执行（存在错误）"},{id:14,name:"exists_fail",label:"正在执行（存在失败）"},{id:15,name:"exists_stop",label:"正在执行（存在终止）"},{id:16,name:"exists_pause",label:"正在执行（存在挂起）"}]}},created:function(){this.handleLoad()},mounted:function(){var e=this;this.$nextTick(function(){e.createGraphic(),e.initGraphEvent()}),window.addEventListener("resize",this.handleChangeCavasSize,!1)},beforeDestroy:function(){window.removeEventListener("resize",this.handleChangeCavasSize,!1),this.graph.destroy()},methods:{handleChangeCavasSize:function(){this.graph.changeSize(this.$refs.main.clientWidth,550),this.graph.fitView([20,30,30,80])},handleLoad:function(){var e=this;this.$api.processHistory.retrieve(parseInt(this.$route.query.id)).then(function(t){t.result?(e.form=t.data,e.form.hasOwnProperty("pre_commands")&&e.$refs.editor.monacoEditor.setValue(e.form.pre_commands),e.renderCanvas(!0)):e.$cwMessage(t.message,"error")})},initGraphEvent:function(){var e=this;this.graph.on("node:click",function(t){var a=t.item.get("model");if(0===a.nodeType||1===a.nodeType||3===a.nodeType)return!1;e.nodeData={data:Object(o.a)(a.node_data),log:a.log,state:a.state,script_content:a.script_content,start_time:a.start_time,end_time:a.end_time,id:a.id},e.nodeSliderKey+=1,e.nodeDrawer.show=!0,e.nodeDrawer.title=a.name})},createGraphic:function(){this.createMenu(),this.initOption(),this.graph=new r.a.Graph(this.cfg)},renderCanvas:function(e){this.mainLoading=!0;var t=this;setTimeout(function(){var a={edges:t.form.pipeline_tree.lines.map(function(t){return{detail:e,id:Object(o.b)(32,16),source:t.from,target:t.to}}),nodes:t.form.pipeline_tree.nodes.map(function(t,a){var n={};return n=0===t.type||1===t.type?{fill:"#fff",r:24}:{width:154,height:40,radius:20,iconCfg:{fill:"#3a84ff"}},i()({},t,{detail:e,label:t.name.length>8?t.name.substr(0,8)+"...":t.name,name:t.name,icon:t.ico,id:t.hasOwnProperty("end_uuid")?t.end_uuid:t.uuid,x:Number(t.left),y:Number(t.top),nodeType:t.type,state:t.state,type:0===t.type||1===t.type?"circle-node":"rect-node",labelCfg:{style:{textAlign:0===t.type||1===t.type?"center":"left"}},style:i()({},n)})})};t.graph.read(a),t.mainLoading=!1},2e3)},initOption:function(){this.cfg=Object(l.a)(r.a,{width:this.$refs.main.clientWidth,height:550,animate:!0,maxZoom:1,fitView:!0,defaultNode:{type:"rect-node",style:{radius:10},labelCfg:{fontSize:20}},defaultEdge:{type:"polyline-edge",style:{radius:0,offset:15,stroke:"#aab7c3",lineAppendWidth:10,endArrow:{path:"M 0,0 L 4,3 L 3,0 L 4,-3 Z",fill:"#aab7c3",stroke:"#aab7c3"},zIndex:999999}},nodeStateStyles:{"nodeState:default":{opacity:1,fill:"#fff",stroke:"#DCDEE5",labelCfg:{style:{fill:"#333333"}}},"nodeState:hover":{opacity:.8},"nodeState:selected":{opacity:.9,stroke:"rgb(58,132,255)",labelCfg:{style:{fill:"rgb(58,132,255)"}}}},plugins:[this.tooltip],modes:{default:["drag-canvas","zoom-canvas","hover-node","drag-node","hover-edge"]}})},createMenu:function(){this.tooltip=new r.a.Tooltip({offsetX:20,offsetY:-20,itemTypes:["node"],getContent:function(e){var t=document.createElement("div");return t.style.width="fit-content",t.innerHTML="\n                  <ul>\n                    <li>"+e.item.getModel().name+"</li>\n                  </ul>",t},shouldBegin:function(e){var t=e.item.get("model");return!(0===t.nodeType||1===t.nodeType||t.name.length<=8)}})}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"jobFlowDetail"}},[a("div",{staticClass:"box"},[a("p",{staticClass:"title"},[e._v("基本信息")]),e._v(" "),a("bk-container",[a("bk-form",{attrs:{"label-width":130}},[a("bk-row",[a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"作业流名称:"}},[e._v(e._s(e.form.name))])],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"作业流状态:"}},[e.form.hasOwnProperty("state")?a("span",[e._v(e._s(e.stateList[e.stateList.findIndex(function(t){return t.name===e.form.state})].label))]):e._e()])],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"启动人:"}},[e._v(e._s(e.form.executor))])],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"跑批系统:"}},[e._v(e._s(e.form.category_name))])],1)],1),e._v(" "),a("bk-row",[a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"计划开始时间:"}},[e._v(e._s(e.form.eta))])],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"实际开始时间:"}},[e._v(e._s(e.form.start_time))])],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"完成时间:"}},[e._v(e._s(e.form.end_time))])],1),e._v(" "),a("bk-col",{attrs:{span:6}},[a("bk-form-item",{attrs:{label:"总共耗时:"}},[e._v(e._s(e.form.total_time))])],1)],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.mainLoading,zIndex:999999},expression:"{ isLoading: mainLoading, zIndex: 999999 }"}],staticClass:"box"},[a("p",{staticClass:"title"},[e._v("执行详情")]),e._v(" "),a("div",{attrs:{id:"content"}},[a("div",{staticClass:"left-statusList"},[a("statusList",{staticStyle:{position:"absolute",left:"20px",top:"15px"}})],1),e._v(" "),a("div",{staticClass:"right-canvas"},[a("div",{ref:"main",attrs:{id:"main"}})])])]),e._v(" "),a("div",{staticClass:"box"},[a("p",{staticClass:"title"},[e._v("前置命令检测")]),e._v(" "),a("editor",{ref:"editor",attrs:{height:"200px",codes:e.form.pre_commands,"read-only":!0,language:"shell"}})],1),e._v(" "),a("div",{staticClass:"box"},[a("p",{staticClass:"title"},[e._v("先行作业/作业流")]),e._v(" "),a("bk-table",{attrs:{data:e.form.upstream_nodes,"ext-cls":"customTable"}},[a("bk-table-column",{attrs:{prop:"type",label:"类型"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"name",label:"名称"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"station",label:"Agent"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"state",label:"状态"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"eta",label:"计划开始时间"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"start_time",label:"实际开始时间"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"end_time",label:"实际完成时间"}})],1)],1),e._v(" "),a("div",{staticClass:"box"},[a("p",{staticClass:"title"},[e._v("后续作业/作业流")]),e._v(" "),a("bk-table",{attrs:{data:e.form.downstream_nodes,"ext-cls":"customTable"}},[a("bk-table-column",{attrs:{prop:"type",label:"类型"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"name",label:"名称"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"station",label:"Agent"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"state",label:"状态"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"eta",label:"计划开始时间"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"start_time",label:"实际开始时间"}}),e._v(" "),a("bk-table-column",{attrs:{prop:"end_time",label:"实际完成时间"}})],1)],1),e._v(" "),a("div",{staticClass:"node-drawer"},[a("bk-sideslider",{attrs:{"is-show":e.nodeDrawer.show,"quick-close":!0,title:e.nodeDrawer.title,width:e.nodeDrawer.width,"ext-cls":"custom-sidelider"},on:{"update:isShow":function(t){return e.$set(e.nodeDrawer,"show",t)},"update:is-show":function(t){return e.$set(e.nodeDrawer,"show",t)}}},[a("node-info",{key:e.nodeSliderKey,attrs:{slot:"content","node-data":e.nodeData},slot:"content"})],1)],1)])},staticRenderFns:[]};var k=a("VU/8")(v,h,!1,function(e){a("SDza")},"data-v-71d90f26",null);t.default=k.exports},"7Xq6":function(e,t){},Cdx3:function(e,t,a){var n=a("sB3e"),i=a("lktj");a("uqUo")("keys",function(){return function(e){return i(n(e))}})},SDza:function(e,t){},fZjL:function(e,t,a){e.exports={default:a("jFbC"),__esModule:!0}},jFbC:function(e,t,a){a("Cdx3"),e.exports=a("FeBl").Object.keys},uqUo:function(e,t,a){var n=a("kM2E"),i=a("FeBl"),s=a("S82l");e.exports=function(e,t){var a=(i.Object||{})[e]||Object[e],o={};o[e]=t(a),n(n.S+n.F*s(function(){a(1)}),"Object",o)}}});